
<html>
    <head>
        <style>
          @media screen and (max-device-width:1400px){
            #pcwin{
                min-width:450px;
                min-height:600px;
            }
          }
         @media screen and (min-device-width:1500px){
            #pcwin{
                width:800px;
                min-height:600px;
            }
          }
          #leftwin,#rightwin{
              min-width:360px;
              min-height:600px;
          }
          #inputURL{
              width:480;
              height:320px;
          }
          iframe{
            resize:both;
          }
          #myiframe,#myqr{
            text-align: center;
            margin:0 auto;
          } 
          #l1,#l2,#r1,#r2,#pctips{
            display:inline-block; 
            min-width:100px
          }       
          .bt {
            height: 32px;
            font-size: 14px;
            background-color: #ddd;
            cursor: pointer;
          }
          #myinput,#myselect{
            height: 32px;
          }
          #pcqr,#leftqr,#rightqr{
            max-width:200px;
            max-height:200px;
          }
       </style>
<script src="jquery.min.js"></script>
<script>
    urls = new Array;
    indatalist = new Array;
    indatas = "xxx"
    global_count = 0

function init()
{
    if(localStorage["urls"]){
        urls = localStorage["urls"].split(/,/);
        insertOption(urls);
    }
  var chrome = navigator.userAgent.toLowerCase().indexOf('chrome') > -1;
  if(!chrome){
     alert("请用Chrome 浏览器");
  }
   if(!localStorage["rightPrefix"]){
     localStorage["rightPrefix"] = "http://m.jd.com/ware/search.action?sid=5f654148714834a434eb01756a585702&catelogyList=&keyword=";
   }
}
function handleForm()
{
  //初始化global_count,显示第一条信息
  global_count = 0
  var init_data = indatas[0];
  //alert(init_data.brand_tag+'god bless me');
  showpcpage(init_data);
  /*
    var x=document.getElementById("mySelect").selectedIndex;
    getPage(urls[x]);
    */
}

function showpcpage(json_data){
  //将json数据变换为html代码展示
  var ret_str = "<span>品牌：brand 建材：material</span><br><br><br>";
  if(!json_data.brand_tag||!json_data.material_tag) {
    alert("亲！你上传的数据有问题哦！请检查一下！");
  }
  ret_str = ret_str.replace("brand", json_data.brand_tag);
  ret_str = ret_str.replace("material", json_data.material_tag);
  for(var iter in json_data.recommend_list){
     var rc_list = json_data.recommend_list; 
     //alert(JSON.stringify(rc_list[iter]));
     var str_link = "<span>product_id: product_id_str product_price: product_price_str</span><br><a href='product_url' target='_blank' onclick=parent.createtagwindows('product_url')> product_name</a><br><br>";
     str_link = str_link.replace(/product_url/g, rc_list[iter].product_link);
     str_link = str_link.replace("product_name", rc_list[iter].product_name);
     str_link = str_link.replace("product_id_str", rc_list[iter].product_id);
     str_link = str_link.replace("product_price_str", rc_list[iter].product_price);
     ret_str = ret_str + str_link;
  }
  //alert(ret_str);
  getPage(ret_str, "pc");
  getPage(json_data.brand_tag+" "+json_data.material_tag, "left");
  getPage(json_data.brand_tag+" "+json_data.material_tag, "right");
}

function setPrefix(side,flag)
{
    if(side == "left"){
        if(flag==1){
            index = "leftPrefix";
            }else{
            index = "leftDataPrefix";
        }
        }else{
        if(flag==1){
            index = "rightPrefix";
            }else{
            index = "rightDataPrefix";
        }
    }

    txt=localStorage[index];

    prefix=prompt("input Prefix:",txt);
    if(prefix!=null && prefix!="null"){
        var t = 'http://';
        if (prefix.length>5 && prefix.substr(0, t.length) !== t){
            prefix = t+ prefix;
        }
       prefix = prefix.replace(/\s+/g,"");
       localStorage[index] = prefix;
       if(!localStorage["history_prefix"]){
           localStorage["history_prefix"] = prefix;
           localStorage["history_prefix"]+=" ";
       }else if(localStorage["history_prefix"].indexOf(prefix) == -1){
           localStorage["history_prefix"]+=prefix;
           localStorage["history_prefix"]+=" ";
       }
    }
   
}

function displayHistoryPrefix()
{
    if(!localStorage["history_prefix"]){
        localStorage["history_prefix"]="";
        if(localStorage["leftPrefix"]){
            localStorage["history_prefix"] += localStorage["leftPrefix"]+" ";
        }
        if(localStorage["rightPrefix"]){
            localStorage["history_prefix"] += localStorage["rightPrefix"]+" ";
        }
    }
    if(localStorage["history_prefix"]){
        document.getElementById("currenturl").innerHTML=localStorage["history_prefix"];
       
    }
}

function insertOption(optionArr)
{
    var x=document.getElementById("mySelect");
    while(x.firstChild){
        x.removeChild(x.firstChild);
    }
    var len=0;
    for (var i in optionArr){
        if ( $.trim(optionArr[i]) == ''){
            continue;
        }
        len++;
        var y=document.createElement('option');
        y.text=len+": " + optionArr[i];
        y.value=i;
        x.add(y,null);// standards compliant
    }
}

    function toggleInput()
    {
         $(".URLtext").toggle(200);

    }
    function handleBatchInput()
    {
        var myinput= $("#inputURL").val();
        t = myinput.split(/\s/);
        urls = new Array;
        for(i in t){
            if(t[i].length>5){
                urls.push(t[i]);
            }
        }
        insertOption(urls);
        localStorage["urls"] = urls; 
         $(".URLtext").toggle(200);
    }
    /*
    function handleInput()
    {
        var myinput= $("#myInput").val();
        alert(myinput)
        myinput = myinput.replace(/\s+/g,"");
        getPage(myinput);
    }
    */
    function handleInputQuery()
    {
        var myinput = $("#myInput").val();
        /*
        url_decode = decodeURIComponent(myinput)
        if(get_where == 0){
          //齐家网
          urlprefix = "http://h5.m.jia.com/jia/do_search/?type=%27app%27&keyword="
        }else if (get_where == 1){
          //京东
          urlprefix = "http://m.jd.com/ware/search.action?sid=5f654148714834a434eb01756a585702&catelogyList=&keyword="
        }
        queryUrl = urlprefix + url_decode
        */
       // getPage(myinput, "pc")
        getPage(myinput, "left")
        getPage(myinput, "right")
    }
    function createtagwindows(url){
      //打开一个标签窗口
      //alert(url);
      window.open(url);
    }

function handleNext(count)
{
  //alert(count+"count"+global_count+"indatas"+indatas.length);
  var ans_count = global_count + count;
  if(ans_count < 0){
    alert("error:上面已经没有数据了亲~ ^-^");
  }else if(ans_count >= indatas.length){
    alert("error: 已经点到底了哦！亲~ ^-^");
  }else{
    global_count = global_count + count;
    showpcpage(indatas[ans_count]);
  }
  /*
    var x=document.getElementById("mySelect").selectedIndex+count;
    document.getElementById("mySelect").selectedIndex=x;
  //alert(x);
  //alert(urls.length);
    if(x>urls.length){
        alert("overflow last url");
        return;
    }
    if(x<0){
        alert("the first url");
        return ;
    }
    getPage(urls[x]);
    */
}

 function handleSelect()
 {
    var count = $("#selectIndex").val() - document.getElementById("mySelect").selectedIndex   
    handleNext(count-1);
 }
  
function getPage(url, position)
{

    var pc = $("#pcwin");
    var left = $("#leftwin");
    var right = $("#rightwin");
    var pcqr = $("#pcqr");
    var leftqr = $("#leftqr");
    var rightqr = $("#rightqr");
    var prefix = 'http://';
    /*
    if (url.substr(0, prefix.length) !== prefix){
        url = prefix + url;
    }*/

    var qr = 'http://bytewang.duapp.com/qr.php?url=';
    var uri = url;
    if(position == "pc"){
      //pc.attr("src",url);
      //pcqr.attr("src",qr+encodeURIComponent(url));
    }else if(position == "left"){
      
      //左边默认出齐家
        if(localStorage["leftPrefix"]!=null){
          //alert(localStorage["leftPrefix"]);
          if(localStorage["leftPrefix"].length<5){
              uri="http://h5.m.jia.com/jia/do_search/?type=%27app%27&keyword="+url;
          }else{
          uri=localStorage["leftPrefix"]+encodeURIComponent(url);
          }
      }else{
          uri="http://h5.m.jia.com/jia/do_search/?type=%27app%27&keyword="+url;
      }  
      left.attr("src",uri)
      leftqr.attr("src",qr+encodeURIComponent(uri));
     
    }else if(position == "right"){
      //右边界面默认出京东
        uri = url;
      if(localStorage["rightPrefix"]!=null){
          if(localStorage["rightPrefix"].length<5){
              uri="http://m.jd.com/ware/search.action?sid=5f654148714834a434eb01756a585702&catelogyList=&keyword="+url;
          }else{
              //alert(uri)
              uri=localStorage["rightPrefix"]+encodeURIComponent(url);
          }
      }else{
          uri="http://m.jd.com/ware/search.action?sid=5f654148714834a434eb01756a585702&catelogyList=&keyword="+url;
      }
      right.attr("src",uri)
      rightqr.attr("src",qr+encodeURIComponent(uri));
    }
     
    //alert(left.attr("src"));

    var le = document.getElementById("lefttips");
    var la = document.getElementById("l1");
    var lda = document.getElementById("l2");

    var re = document.getElementById("righttips");
    var ra = document.getElementById("r1");
    var rda = document.getElementById("r2");
    var apply_news = document.getElementById("applynews");
    var pctips = document.getElementById("pctips");
    var pcbody = pc.contents().find("body") 
    pcbody.append("<span>亲！辛苦了哦~</span>");
    if(position == "pc"){
        //把拼接的本地上传数据显示在iframe中
          //pcbody.clear();
          //pcbody.remove();
          pcbody.html('');
          pcbody.append(url);
      //    alert("append" + url);
     //   pctips.innerHTML="<input class='bt' type='button' onclick=openURL('"+url+"') value=' pc 页面 ' ></input>";
     //   apply_news.innerHTML="<input class='bt' type='button' onclick=openURL('"+left.attr("src")+"&nextpage=1&recache=1') value=' 强制正文页 ' ></input>";
    }else if(position == "left"){
        le.innerHTML="中间窗口前缀: " + localStorage["leftPrefix"];
        la.innerHTML="<input class='bt' type='button' onclick=openURL('"+left.attr("src")+"') value=' 中间窗口 ' ></input>";
    //    lda.innerHTML="<input class='bt' type='button' onclick=openURL('"+left.attr("src")+"&tc_source=1') value=' 中间窗口json数据 ' ></input>";
    }else if(position == "right"){
        re.innerHTML="右边窗口前缀: " + localStorage["rightPrefix"];  
        ra.innerHTML="<input class='bt' type='button' onclick=openURL('"+right.attr("src")+"') value=' 右边窗口 ' ></input>";
    //    rda.innerHTML="<input class='bt' type='button' onclick=openURL('"+right.attr("src")+"&tc_source=1') value=' 右边窗口json数据 ' ></input>";
    }
    
    //document.getElementById("currenturl").innerHTML=url;
}
  function openURL(url)
  {
    window.open(url);
  }
  function controlTips()
  {
    $("#infoTip").toggle(200);
    $("#setInfo").toggle(200);
  }
  function reloadimg(e)
  {     
    src = e.src;
    e.src = src;
  }
  <!-- 文件上传功能 -->

      function fileSelected() {
        var file = document.getElementById('fileToUpload').files[0];
        if (file) {
          var fileSize = 0;
          if (file.size > 1024 * 1024)
            fileSize = (Math.round(file.size * 100 / (1024 * 1024)) / 100).toString() + 'MB';
          else
            fileSize = (Math.round(file.size * 100 / 1024) / 100).toString() + 'KB';

          document.getElementById('fileName').innerHTML = 'Name: ' + file.name;
          document.getElementById('fileSize').innerHTML = 'Size: ' + fileSize;
          document.getElementById('fileType').innerHTML = 'Type: ' + file.type;
        }
      }

      function uploadFile() {
        var fd = new FormData();
        fd.append("fileToUpload", document.getElementById('fileToUpload').files[0]);
        alert(document.getElementById('fileToUpload').files[0]);
        var xhr = new XMLHttpRequest();
        xhr.upload.addEventListener("progress", uploadProgress, false);
        xhr.addEventListener("load", uploadComplete, false);
        xhr.addEventListener("error", uploadFailed, false);
        xhr.addEventListener("abort", uploadCanceled, false);
        xhr.open("POST", "UploadMinimal.aspx");
        xhr.send(fd);
      }
      //add gavin
      function readFile() {
        var file = document.getElementById('fileToUpload').files[0];
        var reader = new FileReader();
        reader.readAsText(file);
        var load_data = "";
        reader.onload = function(){
          var result=document.getElementById("result");
          load_data = this.result;
          //result.innerHTML=this.result; 
          //str to json
          //alert(load_data);
          indatas = JSON.parse(load_data);
          if(!indatas){
            alert("数据有问题哦~ 亲！请检查下，重新输入~");
          }else{
            alert("数据导入成功了哦! 亲~");
          }
          //alert(indatas[0].brand_tag + 'gavin');
          //var data_json = JSON.parse(load_data);
          //alert(data_json[0].brand_tag);
          //alert("test2");
        }
      }

      function uploadProgress(evt) {
        if (evt.lengthComputable) {
          var percentComplete = Math.round(evt.loaded * 100 / evt.total);
          document.getElementById('progressNumber').innerHTML = percentComplete.toString() + '%';
        }
        else {
          document.getElementById('progressNumber').innerHTML = 'unable to compute';
        }
      }

      function uploadComplete(evt) {
        /* This event is raised when the server send back a response */
        alert(evt.target.responseText);
      }

      function uploadFailed(evt) {
        alert("There was an error attempting to upload the file.");
      }

      function uploadCanceled(evt) {
        alert("The upload has been canceled by the user or the browser dropped the connection.");
      }

</script>
<meta charset="utf-8" />
</head>

    <body id="mybody" onload="init()">
      <!-- 文件上传功能 -->
      <form id="form1" enctype="multipart/form-data" method="post" action="upload.php">
<div class="row">
      <label for="fileToUpload">Select a File to Upload</label>
<input type="file" name="fileToUpload" id="fileToUpload" onchange="fileSelected();"/>
    </div>
<div id="fileName"></div>
<div id="fileSize"></div>
<div id="fileType"></div>
<div class="row">
<!--<input type="button" onclick="uploadFile()" value="Upload" />-->
<input type="button" onclick="readFile()" value="Upload" />
    </div>
<div id="progressNumber"></div>
</form>

        <div id="setInfo">
            <!--<input type="button" onclick="toggleInput()" value="批量导入 PC URL" class="bt"/> -->
            <input type="button" onclick="setPrefix('left',1)" value="设置中间窗口前缀" class="bt"> </input>
            <input type="button" onclick="setPrefix('right',1)" value="设置右边窗口前缀" class="bt"></input>
            <input type="button" onclick="displayHistoryPrefix()" value="窗口历史前缀" class="bt"></input>
            <a href=#help> 帮助</a>
            url: <span id="currenturl"></span>
        </div>
        <div class="URLtext" style="display:none">
            <textarea class="URLArea" id="inputURL"></textarea>
            <input type="button" value="导入" id="subUrl" onclick="handleBatchInput()" />
        </div>
        <div>
            <select id="mySelect" style="width:600px" onchange='copyURLText()'>
            </select>
            <input type="button" onclick="handleForm()" value="select data" class="bt">
            <input type="button" onclick="handleNext(1)" value="next data" class="bt">
            <input type="button" onclick="handleNext(-1)" value="pre data" class="bt">
            <!--
            <span style="display:inline-block; border:1px solid red">
              <input type="text" id="selectIndex" value="1" style="width:40px">
              <input type="button" onclick="handleSelect()" value="select xx URL" class="bt"> 
            </span>
            -->
            </br>
            输入一个query :
            <input type="text"  id="myInput" style="width:800px"  /> 
            <input type="button" onclick="handleInputQuery()" value="input query" class="bt"/>
            <input type="button" onclick="controlTips()" value="显示/隐藏窗口信息栏" class="bt" id="controltips"/>
        </div>
        <div id="infoTip">
            <span id="l1">可以用鼠标动态的改变下面3个窗口的大小</span>
            <span id="l2"></span>
            <span id="lefttips"></span>
            
            </br>
            <span id="r1"></span>
            <span id="r2"> </span>
            <span id="pctips"></span>
            <span id="applynews"></span>
            <span id="righttips"></span>
        </div></br>
        <div id="myiframe">          
          <iframe id="pcwin"  sandbox="allow-same-origin allow-forms allow-scripts"></iframe>      
          <iframe id="leftwin" sandbox="allow-same-origin allow-forms allow-scripts"></iframe>
          <iframe id="rightwin" sandbox="allow-same-origin allow-forms allow-scripts"></iframe>       
        </div>
        <div id="result" name="result"></div>
        <div id="help"><pre>
          <!--
          可能的窗口前缀： 
          搜索前端： http://m.baidu.com/l=3/tc?srd=1&dict=30&src=
          可能的数据前缀：http://m.baidu.com/l=3/tc?srd=1&dict=30&tc_source=1&src=    
          批量导入时，会过滤掉低于5个字符的url
        -->
          辛苦了亲们！有什么问题请hi：nealgavin 吧~
          匆忙写的，如有不便，hi上喷吧~
          ^-^
         </pre>          
        </div>
    </body>
</html>
